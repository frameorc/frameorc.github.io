var{readFile:K,writeFile:L,rename:M}=(() => ({}));async function G({read:J,write:b,interval:g=5000}){let q,x,y,z=Infinity;function A(C=g){q??=new Promise((E)=>x=E).then(()=>b(B)).finally(()=>{q=void 0,z=Infinity});let D=Date.now()+C;if(!(D>=z))clearTimeout(y),y=setTimeout(x,C),z=D;return q}let B={save:A,data:void 0};return await J(B),B}async function O(J,b){return await G({interval:b,async write(g){await L(J+".tmp",JSON.stringify(g.data)),await M(J+".tmp",J)},async read(g){try{g.data=JSON.parse(await K(J))}catch(q){if(q.errno!==-2)throw q}}})}export{O as State};
